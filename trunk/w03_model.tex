%$Id: w03_spreading.tex  403 2007-02-03 14:09:19Z gnawux $
%  vim: set ft=tex:
\chapter{移动个人网络中的移动性模型}

\section{引言}

本论文所讨论的分布式终端系统，由个人周边的只能设备自组织构成，由于其成员是泛在计算环境下的各种个人周边的智能设备，逻辑中心是其服务的用户，因此，它是构建在一个特殊的自组织网络之上的。由于这个自组织网络的核心――用户具有很强的移动性，随着用户的移动，网络的形态会发生剧烈的变化，而同时，由于这个网络的构建目的十分明确――服务用户，因此，其行为特征也具有很强的特殊性，本文将这种特殊的自组织网络称为~``移动个人网络~(MPN, Mobile Personal Networks)''~以与一般意义的移动自组织网络~(MANET, Mobile Ad hoc Networks)~相区别。

\section{自组织网络中的移动性模型}

Most of previous research on group mobility of MANET adopted the Reference Point Group Mobility (RPGM) \cite{bib:pei1998,bib:hong1999} mobility model and its variants. In RPGM, each group has a conceptual center, the reference point, represents the group's motion. RPGM is an effective approach on research of MANET in which members move as a group, however, the group mobility of MANET does not consider the heterogeneity and the short range nature of mobile personal networks.

\section{移动个人网络的移动性特征}\label{sse:03:mpnchar}

不同于通常意义上的~MANET，在移动个人网络中的节点是一些各不相同的设备而不是相同或类似的通用计算机，并且这些节点都围绕在一个用户周围，因此，可以如下概括移动个人网络的基本行为特征：

\begin{enumerate}
	\item 设备能力各有不同，且通过异构网络互联。由于移动个人网络之中的节点都是个人周边的设备，这些设备中可能有计算和连接能力非常强设备，比如电视游戏机，它们可能装备了多核~CPU、千兆以太网以及~WLAN，不过也有的设备非常简单，一些无线传感器可能没什么富余的计算能力，网络连接能力也可能仅仅是~ZigBee~这样的低功耗连接。虽然这些设备在能力上相差悬殊，但在应用中，它们各有用武之地。
	\item 设备之间的距离足够近。在移动个人网络之中，所有可用设备都围绕在用户周围，比如居室、办公室、车内等，对于这样的环境，所有设备间的距离都是足够接近的，影响互相之间的可达性的最主要因素不是距离带来的信号衰落，而是连接上的异构性或是通信制式的容纳能力带来的限制。因此，论文中假设同一链路间的各个设备是互相可达的，跨链路转发则依赖于多模设备。
	\item 设备之间的相互移动行为具有组特征。在~MANET~的组移动性研究中，组往往是由于人员组织等造成的，而个人周边的泛在设备的组移动特征更为显著，这些设备通常都是与生俱来地附属于某一实体的，比如车内的~GPS~导航仪、车载音响、车载电视等，又如居室内的电视、游戏机、温度传感器等。所以，这些设备就是按组移动的，而某一时刻下，个人移动网络总是由一个或若干个组组成的。
\end{enumerate}

\section{移动个人网络的分组移动模型}

与一般~MANET~不同，移动个人网络的节点组与连接意义上的链路相互交叉，同一个组的节点有可能会分布在多个链路上，通过承担转发功能的桥接节点互通，而同一链路上的节点也可能属于不同的组，只是随着组的移动，在特定时刻相互可达。基于移动性的节点组同时还具有层次性，如，附着于一件外套上的可穿戴设备本身是一个组，当它被用户穿着起来的时候，就与用户身上的其它便携设备一起，隶属于一个更大的身体范围的设备组了。

图~\ref{fig:mob-mod}~是一个典型的移动个人网络的示意图，这是一个由多个互通的链路构成的异构网络，多模式的桥接节点将不同链路联系在一起。根据~\S~\ref{sse:03:mpnchar}~的分析，在同一链路中，所有设备都可以在一跳之内两两互通。这样，如果在一个移动个人网络之中有~$l$~个链路的话，每个包通过~$l$~条消息就可以达到每个节点。此外，因为个人域的空间范围被限制在一定距离之内，因此，移动性事件对于移动个人网络的影响只是节点的加入与分离和由此影响到的消息路由方式，而并不会因为距离的变化而影响到网络的拓扑结构。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.7\textwidth]{mob-mod}
	\end{center}
	\caption{移动个人网络图示}
	\label{fig:mob-mod}
\end{figure}

\section{基于移动性分组的服务发现} \label{sec:grp}

作为一个面向应用的分布式系统，服务发现机制对于分布式移动终端系统无疑是至关重要的，论文中，为分布式移动终端系统的特定底层承载移动个人网络定制了一个基于移动性分组的服务发现机制。这套机制之中，所有的控制消息都会以组播的形式发送给所有的高级节点，这对于覆盖范围较小的移动个人网络并不会带来太多的开销，为了应对所有可能出现的移动性事件和服务发现需求，我们定义了五类控制消息：
\begin{itemize}
	\item Advertise. 当节点加入系统之中或是自己的能力属性发生变更的时候，它会通过~``Advertise''~消息来通告给系统内的其它设备。
	\item Report. 当节点发现邻居节点从系统之中小时，它会使用~``Report''~消息来通告节点失效事件。
	\item Append. 当节点发现其它节点报告的消息的内容不确切的时候，会通过~``Append''~消息来修正其消息。
	\item Discover. 如果应用对某些功能有需求的时候，会通过~``Discover''~消息来进行资源发现，同时，``Discover''~消息还具有订阅~(Subscribe)~的语义，订阅所需的能力服务器的变更状况。
	\item Notify. 如果节点发现某个能力服务器被某个应用订阅了，其状态恰好发生了改变，它会通过~``Notify''~消息通告应用。
\end{itemize}
通过这些消息，我们设计了一组基于移动性分组的服务发现机制，这套机制包括两大类过程：设备变更引发的过程和应用行为引发的服务发现过程。
%And several special fields may be contained in the control messages: The ``\emph{urgency}'' field denotes whether the message is urgent, and if it is not, it may be cached and merged with other messages in order to reduce the noise; and ``\emph{group}'' field implies that the message may be able to apply to a group if others have no opposite message sent.

\subsection{设备发起的服务发现过程}

当某一设备启动或是正常关闭的时候，设备的变更仅限于发生事件的设备，这一过程被称为~``单设备变更''，仅仅由设备自身向系统中的其它设备发布它的能力变化，不涉及互动。
%When the a device is turned on or normally shutdown, the procedure is considered as a ``single device modification''. As shown in Fig.~\ref{fig:singledev}, a device is announcing that it is turned on and with 2 CSes.

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.6\textwidth]{msc-sdm}
%		\begin{msc}{单设备变更}
%			\declinst{orig}{节点~A}{发起者}
%			\declinst{inter}{节点~B}{桥接节点}
%			\declinst{dest}{节点~C}{其它节点}
%			\mess{设备变更}{orig}{inter}
%			\nextlevel
%			\mess{设备变更}{inter}{dest}
%			\nextlevel
%		\end{msc}
	\end{center}
	\caption{单设备变更的~MSC~图}
	\label{fig:mscsingledev}
\end{figure}

\begin{figure}[htb]
	\texttt{%
Advertise CS JOIN\\
DeviceID: 07707ddd-03d6-46b6-a858-f534e1\\
Urgency: low\\
TTL: 30\\
Servers: 2\\
ServerType: 33dd\\
CAPA: 55\\
ServerType: 49fb\\
CAPA: 45
	}
	\caption{Single Device Modification}
	\label{fig:singledev}
\end{figure}

When a node notices one or more devices are departing from it, which may imply a group is going away, it will send a ``group device modification'' message (Fig. \ref{fig:groupdev}) if no others reported that. In ``group device modification'' message, a hierarchy of groups may be listed, and a latter one must be a subset of a former one. Hence, if any other sends an opposite ``Append message'' against a group (Fig. \ref{fig:append}, the listeners may consider the devices modification is only occurring on its subsets. For instance, the messages in Fig. \ref{fig:groupdev} and \ref{fig:append} shows that \textit{WearableGroup} is a subgroup of \textit{HouseGroup} currently, but \textit{WearableGroup} is going away, while \textit{HouseGroup} stays here, i.e. \textit{WearableGroup} will no longer be a subgroup of it.

\begin{figure}[htb]
	\texttt{%
Report CS LEAVE\\
GroupID: HouseGroup\\
GroupID: WearableGroup\\
Urgency: low\\
TTL: 30\\
DeviceID: 07707ddd-03d6-46b6-a858-f534e1\\
Servers: 2\\
\ldots
	}
	\caption{Group Device Modification}
	\label{fig:groupdev}
\end{figure}

\begin{figure}[htb]
	\texttt{%
Append OPPOSITE LEAVE\\
GroupID: HouseGroup\\
Urgency: low\\
\ldots
	}
	\caption{Append Message}
	\label{fig:append}
\end{figure}

If a node supports multi-mode communication, it will behave as a bridge node, which is responsible for forwarding messages from one link to another. If a ``group device modification'' message is not urgent, the bridge node will not forward it at once, on the contrary, it will wait ``Append'' messages for a while and merge them into the modification message. The bridge operation will introduce a delay
\begin{equation}
	T_b=\max(T_{append})+T_{random},
	\label{eq:bridge}
\end{equation}
where $T_{append}$ is the longest delay of ``Append'' message, and $T_{random}$ is a random delay to avoid collision, even if no ``Append'' message is sent. However, it may prevent from forwarding unnecessary messages. And if the message is tagged as urgency, it will be forward without the $\max(T_{append})$ delay.

\subsection{Application Initiated Procedures}

If an application requires several CSes, it may send a ``Discover Request'' message (Fig. \ref{fig:discover-req}). Then an SN which records the CS satisfying the requirement will reply a ``Discover Response'' message (Fig. \ref{fig:discover-res}). An SN will keep silent if the contents in its record entries have been sent out by others, whereas it will sent an ``Append'' to the response if it has additional information. Moreover, if some CSes do not ready when the application performs a discovery request, the ``Discover Request'' will be refer to as a ``subscribe'' operation, thus, SNs will ``notify'' it whenever the CSes becomes ready. In addition, the notify messages can be sent to nodes with predetermined parameters, which may be used to recompose an application even if the initiate node is not available. 

\begin{figure}[htb]
	\texttt{%
Discover Request\\
ApplicationID: 76ae08ed-7f5d-400f-b931-49c\\
Location: 07707ddd-03d6-46b6-a858-f534e1\\
Urgency: low\\
Servers: 2\\
\ldots
	}
	\caption{Discover Request}
	\label{fig:discover-req}
\end{figure}

\begin{figure}[htb]
	\texttt{%
Discover Response\\
ApplicationID: 76ae08ed-7f5d-400f-b931-49c\\
Location: 07707ddd-03d6-46b6-a858-f534e1\\
Urgency: low\\
Servers: 1\\
\ldots
	}
	\caption{Discover Response}
	\label{fig:discover-res}
\end{figure}

\section{性能分析与仿真}

\subsection{服务发现性能}

\subsection{服务调用性能}


