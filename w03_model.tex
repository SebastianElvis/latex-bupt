%$Id: w03_spreading.tex  403 2007-02-03 14:09:19Z gnawux $
%  vim: set ft=tex:
\chapter{移动个人网络的系统模型}\label{ch:model}

\section{引言}

本论文所讨论的分布式终端系统，由个人周边的智能设备自组织构成，由于其成员是泛在计算环境下的各种个人周边的智能设备，逻辑中心是其服务的用户，因此，它是构建在一个特殊的自组织网络之上的。由于这个自组织网络的核心――用户具有很强的移动性，随着用户的移动，网络的形态会发生剧烈的变化，而同时，由于这个网络的构建目的十分明确――服务用户，因此，其行为特征也具有很强的特殊性，本论文将这种特殊的自组织网络称为~``移动个人网络~(MPN, Mobile Personal Networks)''~以与一般意义的移动自组织网络~(MANET, Mobile Ad hoc Networks)~相区别。

为了对构建于一类网络之上的分布式系统中的协议与机制进行研究、分析与设计，有必要首先对此类网络的特性进行归纳与总结，从而得到其系统模型。本章将分析移动个人网络中设备移动行为的规律与特征，依据这些特征，对移动个人网络的移动性行为与拓扑结构变化进行建模，从而有助于进行进一步的分析与研究。

\section{网络中设备的移动性}\label{sse:03:mm}

各种包含大量移动中工作的设备的分布式系统都需要管理设备的移动性，移动性是影响移动中节点间的相互连通性的重要因素，直接影响分布式系统的拓扑结构。概括地说，移动性的组织和管理通常有外部管理和内部自管理两类，即，通过想对稳定的外部设备了解或达到移动中的目的节点的位置，或由设备自己互相了解协调相互的位置关系，确定如何达到目的节点。这两类移动性组织管理方式通常会对应于有基础设施和无基础设施两类网络架构。

\subsection{有基础设施网络的移动性管理机制与策略}\label{sss:03:inf_mmodel}

对于有基础设施网络，通常使用地址或号码来表示节点的拓扑位置关系，利用地址或号码的前缀可以逐步确定目的节点的位置，这不论在计算机数据通信网络还是在电信网络之中都被普遍采用，而当节点发生移动性的时候，节点和位置不再具有一一对应关系，从而带来了移动性管理问题。不过，对于有基础设施的网络，利用基础设施上的固定或相对固定的参考点作为中继，可以不断跟踪移动中的节点，维持通信的连续性，这一机制在移动通信网络中的~``HLR~(归属位置寄存器)~/~VLR~(访问位置寄存器)''~和~IETF~的移动~IP (MIP)~中的~``HA~(归属地代理)~/~CoA~(转交地址)''~架构设计中都体现无疑。

以移动~IPv6 (MIPv6)\ucite{bib:mipv6}~为例，一个移动节点~(MN)~惟一地拥有一个属于它的归属地址，只要节点可用，任何时候发往这个地址的~IP~分组都可以到达节点，无论该节点在何位置，并且，当节点发生移动，从一个接入路由器~(AR)~的覆盖范围移动到另一个的时候，只要正在进行中的~TCP~连接使用的是节点的归属地址，这个连接都不会中断\footnote{移动过程中可能导致部分丢包，但连接不会中断。}。同时，对应着节点当前接入网络的位置，节点还会有一个~``本地''~的地址，这就是所谓的转交地址~(CoA)，当节点移动的时候，它将自己在新的位置获得的地址\footnote{IPv6~中，不再需要借助一个访问地的代理~FA~进行转发，而是推荐利用无状态自配置~(stateless autoconfiguration)~获得地址，自己做自己的~FA。}作为~CoA，通过绑定更新~(BU)~信令注册到归属地的~HA，HA~便会拦截所有发往~MN~的归属地地址的分组，并转发到~CoA~来。

这种通过代理节点转发机制的移动性管理机制还有进一步的延伸，如层次化~MIPv6 (HMIPv6)\ucite{bib:hmipv6}，即是一种对上述移动性管理机制的优化，主要应用于节点会在某个范围内进行大量~``切换''~的情况。在这样的情况下，大量来往与~MN~和~HA~的~BU~消息会占用过多的带宽，因此考虑在两者之间加入一个移动系泊节点~(MAP)，此类节点负责一个范围内的节点移动事件，对于~MN~来说，MAP~就像~HA，MN~的移动事件都向它注册，而对于~HA，MAP~则表现得像个~MN，当节点进入一个~MAP~的覆盖范围的时候，MAP~会向~HA~发送~BU~消息，这样，如果~MN~的大部分移动都发生在覆盖范围合理的~MAP~范围之内，将节约大量的帮等更新信令带来的信令开销，因此，这种方式也称为微移动性管理。

而将上述机制进一步推广，甚至可以考虑将接入路由器~(AR)~或~MAP~也移动起来，移动性不仅仅发生在单个节点上，作为网络的对外出口的路由器，也可能会移动，这就是网络移动性~(MEMO, NEtwork MObility)\ucite{bib:nemo}，整个网络都采用~MIP~的方式，通过对可移动路由器进行移动性管理，保持移动过程中整个网络的通信的连续性。并且，我们可以进一步在移动的网络中嵌入较小的移动的网络\ucite{bib:ernst2004,bib:montavont2004}，层次化地管理网络与节点的移动，可见，对于有基础设施类的移动性管理，并非一定完全依赖绝对固定的设施，相对稳定的节点同样可以承担移动性管理的工作。

\subsection{无基础设施网络的移动性模型}

对于以~MANET~为代表的无基础设施的移动网络，移动节点之间的可达性主要是依靠节点之间互相转发来实现的，每个节点都可以充当路由器和主机两种功能，而源节点到目的节点间的可达性管理也就是路由的管理。路由的维护与更新是与节点间的连通性关联的，通常的~MANET~中，这种连通性是由移动节点的相对位置、相对移动方向与速度以及节点的通信半径~――~节点的移动性~――~所决定的。MANET~中的通用移动性模型有两大类\ucite{bib:davies2000,bib:camp2002}：节点移动模型和组移动模型。

所谓节点移动模型，是指各个节点的运动方式没有相关性，节点自行决定自己的运动方向与速度，实时改变节点之间的位置关系，从而影响节点间的连接状况。不同的节点移动模型中，可以改变的参数不尽相同，在什么条件下改变参数也不一样。以常见的~``常速率随机方向''~模型为例，所有节点的速率都是一样的，而方向则是随机确定的，一旦方向确定后，就不再改变，直到节点撞倒仿真区域边界，此时它会被边界反弹回来；而在~``Random Waypoint''~模型中，节点每个固定的时间间隔走一步，在一步之后节点会重新选择一个移动速度和方向，迈出下一步。所有这些模型，都可以用来确定某个时刻各个节点间的相互位置关系，从而计算出节点间的可达性，进而进行路由策略的选择。

与节点移动模型不同，组移动模型考虑了实际应用中的另一类常见现象：具有相关性的节点的移动往往同样具有相关性，如，如果一组便携计算机属于商务旅行团的不同成员，它们在旅行途中常常会一起移动，这样的情况在军事、科学考察等活动中同样常见。于是，可以将设备的移动性划分为两类移动：组的移动和组内的相互移动，确定节点的位置也就相应的分为两步：确定组中心的位置和确定节点想对组中心的位置，这就是经典的~``参考点组移动~(RPGM)''~模型\ucite{bib:hong99,bib:pei99}。分组移动往往暗示着层次化~(Hierachical)，因为组的中心常常对应于组的头领节点，包可以先交给组头，然后经组头传递给目的节点，这样，对于组间通信，只需要了解组头节点的位置，而对于组内通信，则只需要了解组内想对位置即可，这种位置确定的策略和~\S~\ref{sss:03:inf_mmodel}~中谈到的~HMIPv6~有异曲同工之妙。

\section{移动个人网络的移动性特征}\label{sse:03:mpnchar}

移动性模型的研究的目的是为了确定节点的运动特征，从而得到节点之间的相互连通性，而节点之间的连通性并非只由节点在三维空间中的位置关系所决定，同时，还受到节点发射功率、通信制式~(包括空中接口特征和链路层限制)~等因素的左右。上述~MANET~移动性模型中，大多假设各个节点的通信能力是完全相同的，即具有同构性，这对于计算机数据通信应用来说是无可厚非的，但显然并不适用于移动个人网络，对于移动个人网络的节点间的连同性，应考虑更复杂的移动性特征。

不同于通常意义上的~MANET，在移动个人网络中的节点是一些各不相同的设备而不是相同或类似的通用计算机，并且这些节点都围绕在一个用户周围，因此，可以如下概括移动个人网络的基本行为特征：

\begin{enumerate}
	\item 设备能力各有不同，且通过异构网络互联。由于移动个人网络之中的节点都是个人周边的设备，这些设备中可能有计算和连接能力非常强设备，比如电视游戏机，它们可能装备了多核~CPU、千兆以太网以及~WLAN，不过也有的设备非常简单，一些无线传感器可能没什么富余的计算能力，网络连接能力也可能仅仅是~ZigBee~这样的低功耗连接。虽然这些设备在能力上相差悬殊，但在应用中，它们各有用武之地。
	\item 设备之间的距离足够近。在移动个人网络之中，所有可用设备都围绕在用户周围，比如居室、办公室、车内等，对于这样的环境，所有设备间的距离都是足够接近的，影响互相之间的可达性的最主要因素不是距离带来的信号衰落，而是连接上的异构性或是通信制式的容纳能力带来的限制。因此，论文中假设同一链路间的各个设备是互相可达的，跨链路转发则依赖于多模设备。
	\item 设备之间的相互移动行为具有组特征。在~MANET~的组移动性研究中，组往往是由于人员组织等造成的，而个人周边的泛在设备的组移动特征更为显著，这些设备通常都是与生俱来地附属于某一实体的，比如车内的~GPS~导航仪、车载音响、车载电视等，又如居室内的电视、游戏机、温度传感器等。所以，这些设备就是按组移动的，而某一时刻下，个人移动网络总是由一个或若干个组组成的。
\end{enumerate}

\section{移动个人网络的分组移动模型}

% B 两种状态: 可用或不可用
基于上述分析，我们着手建立一个用于确定节点连通性的移动个人网络移动性模型。首先，根据设备之间的短距离性，我们可以认为移动个人网络中的设备只有两个离散状态：``可用~(Available)''~或~``不可用~(Unavailable)''，即当节点远离个任移动网络的中心后，就将不再服务于网络，相对于网络进入了不可用状态，这是由移动个人网络的显著的以用户为中心这一特性所决定的。因为个人移动网络的移动性只考虑可用与不可用两个离散的状态，所以，运动的速度和方向对位置的影响将不再被考虑，而仅仅考虑节点在下一时刻的可用性，这可以认为是~``Waypoint''~移动模型在极限情况下的一种特例。

% A 基于组的移动性模型
从移动性事件看，这应该属于一个组移动模型，因为所有节点都附着于某些相互之间具有移动性的实体之上，因此，节点可能成组地变为可用或不可用，因此移动个人网络分组移动模型中，将系统分成一系列的时间间隔，每个间隔都需要考虑下一时间点上，某组设备会变成可用或是不可用，通常，这一变化是具有惰性的，即，加入的组一般不会立刻分开，而离开的组也不会很快加入，因此，每个组的状态可以近似用一个两状态的马尔可夫过程来表示。

% C 通信方式: 与组独立，通过桥接节点到达目的节点
与一般~MANET~不同，尽管移动个人网络中的移动性是基于组的，但基于组的层次化通信并不能简化寻址操作，这是因为，一方面节点之间只要连接在同一网络介质上，就相互可达，不论是否同组，同样，即使同一组内的节点也可能属于不同链路，需要中继才能相互通信，因此，节点间的通信过程中并不需要涉及组这个单位。另一方面，移动个人网络是一个面向应用的网络，并不强调节点的地址，而是服务导向的，因此，基于组织、连接的寻址方式会和服务发现机制结合起来，这也使得寻址过程与~MANET~不尽相同，组头节点的存在也变得意义不大。

% D 组的层次性
此外，移动个人网络之中，移动性组同时还具有层次性，如，附着于一件外套上的可穿戴设备本身是一个组，当它被用户穿着起来的时候，就与用户身上的其它便携设备一起，隶属于一个更大的身体范围的设备组了。从整体看，移动个人网络本身就是一个顶级的组，所有系统中的组都隶属与这个组，当一个组离开这个顶级组的时候，它也就变为不可用状态了。不难理解，移动性组之间，只允许相互不相交或是子集的关系，而不允许两个组相交，即，对于两个节点组~$N=\{n_i|i=1,2\cdots\}$，$M=\{m_i|i=1,2,\cdots\}$，若
\begin{equation}
	\exists n_k \quad \in M, m_l \not \in N
	\label{eq:hira_cond}
\end{equation}
则
\begin{equation}
	N \subset M
	\label{eq:hira_concl}
\end{equation}

图~\ref{fig:mob-mod}~是一个典型的移动个人网络的示意图，这是一个由多个互通的链路构成的异构网络，多模式的桥接节点将不同链路联系在一起。根据~\S~\ref{sse:03:mpnchar}~的分析，在同一链路中，所有设备都可以在一跳之内两两互通。这样，如果在一个移动个人网络之中有~$l$~个链路的话，每个包通过~$l$~条消息就可以达到每个节点。此外，因为个人域的空间范围被限制在一定距离之内，因此，移动性事件对于移动个人网络的影响只是节点的加入与分离和由此影响到的消息路由方式，而并不会因为距离的变化而影响到网络的拓扑结构。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.9\textwidth]{mob-mod}
	\end{center}
	\caption{移动个人网络图示}
	\label{fig:mob-mod}
\end{figure}

\section{移动个人网络中的离散事件仿真}

离散事件仿真是一种建模观察系统基于时间的行为~(或动态行为)~的方法\ucite{bib:ball96}。我们常常用一个离散事件模型来仿真网络系统中的各种事件，如节点网络应用的行为、节点移动事件等。通常，离散事件仿真中要包含如下要素：仿真中的实体和实体间的关系，时钟，概率分布，事件的运行，以及结果分析~(图~\ref{fig:desimu}\ucite{bib:ball96})。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.9\textwidth]{struct}
	\end{center}
	\caption{离散事件仿真中的要素}
	\label{fig:desimu}
\end{figure}

这之中，最重要的莫过于实体和实体之间的关系\ucite{bib:kreutzer86}，对于网络仿真，这包括节点、链路、运行与节点上的应用以及节点间的拓扑关系、移动性关系，离散事件仿真就是模拟这些应用、节点以及链路的状态随着时间在一定分布发生变化时的情景，得到一定的输出结果并进行分析。

在本论文中，使用~NS-2\ucite{bib:ns2}~作为离散事件仿真工具，该程序使用~C++~编写内核，OTcl~脚本语言驱动仿真和事件调度，本论文中的离散事件仿真中，作者使用一个外挂程序来生成移动个人网络的拓扑和移动性事件，使用这个方法的优点在于不需要修改~NS-2~中的节点架构和寻址架构，可以较好地利用前人已有的工作成果。通过外挂程序生成的拓扑结构和移动性变化事件可以直接在~NS-2~中进行仿真。

\subsection{移动个人网络中节点的拓扑关系}

单纯考虑移动个人网络中的拓扑关系而不考虑移动性问题，而仅考虑移动个人网络的异构性和短距离性，移动个人网络可以简化为一个通过若干路由节点互联的几个局域网段，每个网段内节点之间一跳可达~(如图~\ref{fig:topo})。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.9\textwidth]{topo}
	\end{center}
	\caption{移动个人网络中的拓扑关系}
	\label{fig:topo}
\end{figure}

在我们的外挂程序的输入文件中，需要给出每个链路上的节点和链路的带宽、时延、丢包率参数，根据这些参数，外挂程序可以输出~NS-2~的节点描述语句。在确定了节点的固定拓扑关系后，需要考虑节点和链路的动态性，这由外挂程序的事件发生生成功能完成。

\subsection{移动个人网络中节点的移动性事件}

生成了静态的拓扑结构之后，外挂程序的工作是通过各种事件来改变节点和链路的状态，从而影响拓扑。对于移动个人网络这个个人周边的自组织系统，我们需要考虑的事件有：
\begin{enumerate}
	\item 应用层网络通信事件；
	\item 节点可用性状态变化事件；
	\item 节点所在组状态变化事件。
\end{enumerate}
这里，对于节点组的加入或分离，即移动性事件是移动个人网络所特有的，也是论文考察的要点，由于组移动事件是用户移动造成的，通常在短时间内不会连续发生移动事件，若忽略移动性事件之间的关联性，则可以认为事件的发生具有历史无关性，即，是一个泊松过程，这样，移动个人网络的拓扑变化时间间隔将服从负指数分布，其概率密度函数为
\begin{equation}
	f(t)=\lambda{}e^{-\lambda{}t}
	\label{eq:exponent}
\end{equation}
其中，$1/\lambda$~为时间间隔的期望值。而对于节点可用性状态的变化，论文所考虑的情况下，这一事件的发生概率远低于组移动事件，因此忽略。

同时，由于移动个人网络中的节点不仅分别在不同链路上通信，而且还属于具有层次性的移动性组，因此，这些节点可以使用一个树状结构进行组织。如图~\ref{fig:tree}~所示，所有移动个人网络中的节点在图中位于叶子节点的位置，而不同级别的组则由位于不同深度的节点表示，跟节点代表整个移动个人网络，这正符合移动个人网络中的移动性组的定义。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=\textwidth]{tree}
	\end{center}
	\caption{节点的树状组织}
	\label{fig:tree}
\end{figure}

当发生组移动事件时，代表该组子树中的所有节点的状态会相应的发生改变，如图~\ref{fig:tree-leave}，一个一级组离开，对应于模型中一个深度为~$1$~的树节点的状态成为不可用，因此，整个子树的状态会全部变为不可用，即其所包含的两个二级组以及组内的所有设备节点全部进入不可用的状态。而当节点组加入的时候~(图~\ref{fig:tree-join})，该子树中的节点的状态也相应的由不可用变为可用，并且，如果由该组对应的树节点一直上溯至树根节点的所有节点的先前的状态如果是不可用的话，也会变为可用。

\begin{figure}[htb]
	\begin{center}
		\subfloat[组离开的情况]{\label{fig:tree-leave}%
			\includegraphics[width=\textwidth]{tree-leave}%
		}\\
		\subfloat[组加入的情况]{\label{fig:tree-join}%
			\includegraphics[width=\textwidth]{tree-join}%
		}
	\end{center}
	\caption{节点树在发生移动性事件时的变化}
	\label{fig:tree-trans}
\end{figure}

在我们的外挂程序中，可以根据输入文件中的组描述信息和事件发生时间间隔设置，以负指数分布时间间隔生成组移动事件，翻转随机选定的组的移动性状态，改变该组的成员和连接链路的状态。

\FloatBarrier
\section{小结}

本章对分布式终端系统的载体~――~移动个人网络的行为特征进行了分析和归纳，并在此基础上对移动个人网络节点的短距离性、异构性和组移动性给出了一个基于组的移动性模型和相应的离散事件模型，描述了基于移动性组的节点逻辑结构和移动性事件的发生规律，并通过一个外挂程序将这个离散事件与~NS-2~离散事件仿真程序相结合起来。

