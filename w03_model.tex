%$Id: w03_spreading.tex  403 2007-02-03 14:09:19Z gnawux $
%  vim: set ft=tex:
\chapter{移动个人网络中的移动性模型}

\section{引言}

本论文所讨论的分布式终端系统，由个人周边的只能设备自组织构成，由于其成员是泛在计算环境下的各种个人周边的智能设备，逻辑中心是其服务的用户，因此，它是构建在一个特殊的自组织网络之上的。由于这个自组织网络的核心――用户具有很强的移动性，随着用户的移动，网络的形态会发生剧烈的变化，而同时，由于这个网络的构建目的十分明确――服务用户，因此，其行为特征也具有很强的特殊性，本论文将这种特殊的自组织网络称为~``移动个人网络~(MPN, Mobile Personal Networks)''~以与一般意义的移动自组织网络~(MANET, Mobile Ad hoc Networks)~相区别。

\section{自组织网络中的移动性模型}

Most of previous research on group mobility of MANET adopted the Reference Point Group Mobility (RPGM)  mobility model and its variants. In RPGM, each group has a conceptual center, the reference point, represents the group's motion. RPGM is an effective approach on research of MANET in which members move as a group, however, the group mobility of MANET does not consider the heterogeneity and the short range nature of mobile personal networks.

\section{移动个人网络的移动性特征}\label{sse:03:mpnchar}

不同于通常意义上的~MANET，在移动个人网络中的节点是一些各不相同的设备而不是相同或类似的通用计算机，并且这些节点都围绕在一个用户周围，因此，可以如下概括移动个人网络的基本行为特征：

\begin{enumerate}
	\item 设备能力各有不同，且通过异构网络互联。由于移动个人网络之中的节点都是个人周边的设备，这些设备中可能有计算和连接能力非常强设备，比如电视游戏机，它们可能装备了多核~CPU、千兆以太网以及~WLAN，不过也有的设备非常简单，一些无线传感器可能没什么富余的计算能力，网络连接能力也可能仅仅是~ZigBee~这样的低功耗连接。虽然这些设备在能力上相差悬殊，但在应用中，它们各有用武之地。
	\item 设备之间的距离足够近。在移动个人网络之中，所有可用设备都围绕在用户周围，比如居室、办公室、车内等，对于这样的环境，所有设备间的距离都是足够接近的，影响互相之间的可达性的最主要因素不是距离带来的信号衰落，而是连接上的异构性或是通信制式的容纳能力带来的限制。因此，论文中假设同一链路间的各个设备是互相可达的，跨链路转发则依赖于多模设备。
	\item 设备之间的相互移动行为具有组特征。在~MANET~的组移动性研究中，组往往是由于人员组织等造成的，而个人周边的泛在设备的组移动特征更为显著，这些设备通常都是与生俱来地附属于某一实体的，比如车内的~GPS~导航仪、车载音响、车载电视等，又如居室内的电视、游戏机、温度传感器等。所以，这些设备就是按组移动的，而某一时刻下，个人移动网络总是由一个或若干个组组成的。
\end{enumerate}

\section{移动个人网络的分组移动模型}

与一般~MANET~不同，移动个人网络的节点组与连接意义上的链路相互交叉，同一个组的节点有可能会分布在多个链路上，通过承担转发功能的桥接节点互通，而同一链路上的节点也可能属于不同的组，只是随着组的移动，在特定时刻相互可达。基于移动性的节点组同时还具有层次性，如，附着于一件外套上的可穿戴设备本身是一个组，当它被用户穿着起来的时候，就与用户身上的其它便携设备一起，隶属于一个更大的身体范围的设备组了。

图~\ref{fig:mob-mod}~是一个典型的移动个人网络的示意图，这是一个由多个互通的链路构成的异构网络，多模式的桥接节点将不同链路联系在一起。根据~\S~\ref{sse:03:mpnchar}~的分析，在同一链路中，所有设备都可以在一跳之内两两互通。这样，如果在一个移动个人网络之中有~$l$~个链路的话，每个包通过~$l$~条消息就可以达到每个节点。此外，因为个人域的空间范围被限制在一定距离之内，因此，移动性事件对于移动个人网络的影响只是节点的加入与分离和由此影响到的消息路由方式，而并不会因为距离的变化而影响到网络的拓扑结构。

\begin{figure}[htb]
	\begin{center}
		\includegraphics[width=.7\textwidth]{mob-mod}
	\end{center}
	\caption{移动个人网络图示}
	\label{fig:mob-mod}
\end{figure}

\section{基于移动性分组的服务发现} \label{sec:grp}

作为一个面向应用的分布式系统，服务发现机制对于分布式移动终端系统无疑是至关重要的，论文中，为分布式移动终端系统的特定底层承载移动个人网络定制了一个基于移动性分组的服务发现机制。这套机制之中，所有的控制消息都会以组播的形式发送给所有的高级节点，这对于覆盖范围较小的移动个人网络并不会带来太多的开销，为了应对所有可能出现的移动性事件和服务发现需求，我们定义了五类控制消息：
\begin{itemize}
	\item Advertise. 当节点加入系统之中或是自己的能力属性发生变更的时候，它会通过~``Advertise''~消息来通告给系统内的其它设备。
	\item Report. 当节点发现邻居节点从系统之中小时，它会使用~``Report''~消息来通告节点失效事件。
	\item Append. 当节点发现其它节点报告的消息的内容不确切的时候，会通过~``Append''~消息来修正其消息。
	\item Discover. 如果应用对某些功能有需求的时候，会通过~``Discover''~消息来进行资源发现，同时，``Discover''~消息还具有订阅~(Subscribe)~的语义，订阅所需的能力服务器的变更状况。
	\item Notify. 如果节点发现某个能力服务器被某个应用订阅了，其状态恰好发生了改变，它会通过~``Notify''~消息通告应用。
\end{itemize}
通过这些消息，我们设计了一组基于移动性分组的服务发现机制，这套机制包括两大类过程：设备变更引发的过程和应用行为引发的服务发现过程。
%And several special fields may be contained in the control messages: The ``\emph{urgency}'' field denotes whether the message is urgent, and if it is not, it may be cached and merged with other messages in order to reduce the noise; and ``\emph{group}'' field implies that the message may be able to apply to a group if others have no opposite message sent.

\subsection{设备发起的服务发现过程}

当某一设备启动或是正常关闭的时候，设备的变更仅限于发生事件的设备，这一过程被称为~``单设备变更''，仅仅由设备自身向系统中的其它设备发布它的能力变化，不涉及互动，图~\ref{fig:mscsingledev}~是这一过程的~MSC~图。

\begin{figure}[tb]
	\begin{center}
		\includegraphics[width=.6\textwidth]{msc-sdm}
	\end{center}
	\caption{单设备变更的~MSC~图}
	\label{fig:mscsingledev}
\end{figure}

图~\ref{fig:singledev}~是设备开启时发送的单设备变更消息示例，消息以控制消息类型~(Advertise)~开头，并说明消息是声明新加入的能力服务器，并在消息之中描述了两个新加入的能力服务器的类型和能力值。

\begin{figure}[tb]
	\begin{center}
	\framebox{%
	\begin{minipage}[t]{.8\textwidth}%
	\texttt{%
Advertise CS JOIN\\
DeviceID: 07707ddd-03d6-46b6-a858-f534e1\\
Urgency: low\\
TTL: 30\\
Servers: 2\\
ServerType: 33dd\\
CAPA: 55\\
ServerType: 49fb\\
CAPA: 45
	}%
	\end{minipage}%
	}
	\end{center}
	\caption{单设备变更消息示例}
	\label{fig:singledev}
\end{figure}

与上述过程不同，当一个节点注意到它与相邻节点的连接在没有得到任何通告的情况下中断的时候，它无法判断该节点是因为自身出现故障而失效还是该节点与其所在的组一起离开了自己的通信范围，而如果是后者，因为移动性分组具有层次性，统一节点可能会依次隶属与从小到大的若干个组，是哪个组离开同样不能确定。因此，报告离开事件的节点会假设最大组已经离开，而发送出~``Report''~消息，而收到消息的其它节点如果发现消息中所述的组实际并没有离开则会发出~``Append''~消息，来对这个消息进行补充。图~\ref{fig:mscgroupdepart}~展示了节点离开报告的典型过程，图中特别地标示了连接不同链路的桥接节点的行为，该节点对于收到的~``Report''~消息并不立刻转发到其它介质中去，而是等待一段时间，在这期间，如果有节点发出~``Append''~消息，桥接节点在转发的时候会将上述消息汇聚在一起，形成一个更加简短、准确的~``Report''~消息转发出来。这一熔合转发过程会引入一个~``桥接时延''
\begin{equation}
	T_b=\max(T_{append})+T_{random},
	\label{eq:bridge}
\end{equation}
其中~$T_{append}$~是~``Append''~消息可能导致的最长时延，而~$T_{random}$~是一个用于避免碰撞的随机时延，由于是否会有~``Append''~消息不可预知，即使没有~``Append''~消息，这个时延也不可避免，不过，这个时延的引入可以防止不必要的消息转发。并且，如果消息被标记为~``Urgency~(紧急的)''，该消息会的转发时延中将没有~$T_{append}$~这一部分。

\begin{figure}[tb]
	\begin{center}
		\includegraphics[width=.6\textwidth]{msc-rpt}
	\end{center}
	\caption{节点离开报告消息的~MSC~图}
	\label{fig:mscgroupdepart}
\end{figure}

图~\ref{fig:groupleave}~给出了一个设备成组离开的例子。如图~\ref{fig:reportleave}，一个设备发现另一个设备~``消失''~了，它将该设备，连同该设备所在的组~``WearableGroup''~以及再上级的组~``HouseGroup''~全部报告为~``离开''；随后，这条消息被另一个设备发出的补充说明~(图~\ref{fig:append})~所纠正――``HouseGroup''~仍然没有离开；接收到全部这些消息之后，桥接节点转发出去的节点离开报告~(图~\ref{fig:bdgreport})~之中已经不包括~``HouseGroup''~组了，离开的只有~``WearableGroup''~组，也就是说，``WearableGroup''~组已经不是~``HouseGroup''~组的一个部分了。

\begin{figure}[htb]
	\subfloat[组离开报告消息]{\label{fig:reportleave}%
	\framebox{\begin{minipage}[t]{0.48\textwidth}
		\texttt{%
Report CS LEAVE\\
GroupID: HouseGroup\\
GroupID: WearableGroup\\
Urgency: low\\
TTL: 30\\
DeviceID: 07707ddd-03d6-46b6\\
Servers: 2\\
\ldots}%
	\end{minipage}}%
	}\qquad
	\begin{minipage}[t]{.48\textwidth}%
		\vspace{-1em}
		\subfloat[补充说明消息]{\label{fig:append}%
		\framebox{\begin{minipage}[t]{\textwidth}
		\texttt{%
Append OPPOSITE LEAVE\\
GroupID: HouseGroup\\
Urgency: low\\
\ldots }%
		\end{minipage}}%
		}\\
		\subfloat[桥接节点转发的报告消息]{\label{fig:bdgreport}%
		\framebox{\begin{minipage}[t]{\textwidth}
		\texttt{%
Report CS LEAVE\\
GroupID: WearableGroup\\
Urgency: low\\
\ldots }%
		\end{minipage}}%
		}
	\end{minipage}
	\caption{组离开消息报告示例}
	\label{fig:groupleave}
\end{figure}

\subsection{应用发起的服务发现过程}

如果一个应用在业务生成的过程中需要若干能力服务器，这时，它需要通过~``Discover Request''~消息来进行服务发现，而记录有拥有符合应用需求高级节点会给出相应的响应，将所记录的能力服务器的信息告知应用，应用进行确认之后就完成了服务发现的过程，可以调用其需要的能力服务器了，当然，确认之前应用和能力服务器可能还需要进行双方的协商。图~\ref{fig:mscservicediscover}~给出了这一过程的~MSC~图，值得注意的是，图中各个节点充当的角色只是该节点在这一过程中所充当的角色，各个节点在系统中是平等的，任何节点都有可能提供能力服务器，任意高级节点都可以作为目录节点。

\begin{figure}[tb]
	\begin{center}
		\includegraphics[width=.6\textwidth]{msc-req}
	\end{center}
	\caption{服务发现过程的~MSC~图}
	\label{fig:mscservicediscover}
\end{figure}
%If an application requires several CSes, it may send a ``Discover Request'' message (Fig. \ref{fig:discover-req}). Then an SN which records the CS satisfying the requirement will reply a ``Discover Response'' message (Fig. \ref{fig:discover-res}). An SN will keep silent if the contents in its record entries have been sent out by others, whereas it will sent an ``Append'' to the response if it has additional information. Moreover, if some CSes do not ready when the application performs a discovery request, the ``Discover Request'' will be refer to as a ``subscribe'' operation, thus, SNs will ``notify'' it whenever the CSes becomes ready. In addition, the notify messages can be sent to nodes with predetermined parameters, which may be used to recompose an application even if the initiate node is not available. 

%\begin{figure}[htb]
%	\texttt{%
%Discover Request\\
%ApplicationID: 76ae08ed-7f5d-400f-b931-49c\\
%Location: 07707ddd-03d6-46b6-a858-f534e1\\
%Urgency: low\\
%Servers: 2\\
%\ldots
%	}
%	\caption{Discover Request}
%	\label{fig:discover-req}
%\end{figure}
%
%\begin{figure}[htb]
%	\texttt{%
%Discover Response\\
%ApplicationID: 76ae08ed-7f5d-400f-b931-49c\\
%Location: 07707ddd-03d6-46b6-a858-f534e1\\
%Urgency: low\\
%Servers: 1\\
%\ldots
%	}
%	\caption{Discover Response}
%	\label{fig:discover-res}
%\end{figure}

\section{性能分析与仿真}

\subsection{服务发现性能}

\subsection{服务调用性能}


